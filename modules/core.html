<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Core 模块 | Jvavscratch</title>
    <meta name="description" content="JavaScript到Scratch的转换工具 - 让编程学习更简单">
    <meta name="generator" content="VitePress v1.6.4">
    <link rel="preload stylesheet" href="/jvavscratch/assets/style.DJeJHnmQ.css" as="style">
    <link rel="preload stylesheet" href="/jvavscratch/vp-icons.css" as="style">
    
    <script type="module" src="/jvavscratch/assets/app.an1V1H8V.js"></script>
    <link rel="preload" href="/jvavscratch/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/jvavscratch/assets/chunks/theme.D7pJ9kbE.js">
    <link rel="modulepreload" href="/jvavscratch/assets/chunks/framework.BkKiziiH.js">
    <link rel="modulepreload" href="/jvavscratch/assets/modules_core.md.B4quvw7D.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-d8b57b2d><!--[--><!--]--><!--[--><span tabindex="-1" data-v-fcbfc0e0></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-fcbfc0e0>Skip to content</a><!--]--><!----><header class="VPNav" data-v-d8b57b2d data-v-7ad780c2><div class="VPNavBar" data-v-7ad780c2 data-v-9fd4d1dd><div class="wrapper" data-v-9fd4d1dd><div class="container" data-v-9fd4d1dd><div class="title" data-v-9fd4d1dd><div class="VPNavBarTitle has-sidebar" data-v-9fd4d1dd data-v-9f43907a><a class="title" href="/jvavscratch/" data-v-9f43907a><!--[--><!--]--><!--[--><img class="VPImage logo" src="/jvavscratch/logo.svg" alt data-v-ab19afbb><!--]--><span data-v-9f43907a>Jvavscratch</span><!--[--><!--]--></a></div></div><div class="content" data-v-9fd4d1dd><div class="content-body" data-v-9fd4d1dd><!--[--><!--]--><div class="VPNavBarSearch search" data-v-9fd4d1dd><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-9fd4d1dd data-v-afb2845e><span id="main-nav-aria-label" class="visually-hidden" data-v-afb2845e> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/jvavscratch/" tabindex="0" data-v-afb2845e data-v-815115f5><!--[--><span data-v-815115f5>首页</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/jvavscratch/guide/" tabindex="0" data-v-afb2845e data-v-815115f5><!--[--><span data-v-815115f5>指南</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/jvavscratch/grammar/" tabindex="0" data-v-afb2845e data-v-815115f5><!--[--><span data-v-815115f5>语法</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/jvavscratch/api/" tabindex="0" data-v-afb2845e data-v-815115f5><!--[--><span data-v-815115f5>API</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/jvavscratch/modules/" tabindex="0" data-v-afb2845e data-v-815115f5><!--[--><span data-v-815115f5>模块</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/jvavscratch/faq/" tabindex="0" data-v-afb2845e data-v-815115f5><!--[--><span data-v-815115f5>常见问题</span><!--]--></a><!--]--><!--[--><a class="VPLink link vp-external-link-icon VPNavBarMenuLink" href="https://github.com/Jvavscratch/jvavscratch" target="_blank" rel="noreferrer" tabindex="0" data-v-afb2845e data-v-815115f5><!--[--><span data-v-815115f5>GitHub</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-9fd4d1dd data-v-3f90c1a5><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-3f90c1a5 data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-9fd4d1dd data-v-ef6192dc data-v-e71e869c><!--[--><a class="VPSocialLink no-icon" href="https://github.com/Jvavscratch/jvavscratch" aria-label="github" target="_blank" rel="noopener" data-v-e71e869c data-v-60a9a2d3><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-9fd4d1dd data-v-f953d92f data-v-bfe7971f><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-bfe7971f><span class="vpi-more-horizontal icon" data-v-bfe7971f></span></button><div class="menu" data-v-bfe7971f><div class="VPMenu" data-v-bfe7971f data-v-20ed86d6><!----><!--[--><!--[--><!----><div class="group" data-v-f953d92f><div class="item appearance" data-v-f953d92f><p class="label" data-v-f953d92f>Appearance</p><div class="appearance-action" data-v-f953d92f><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-f953d92f data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div></div></div><div class="group" data-v-f953d92f><div class="item social-links" data-v-f953d92f><div class="VPSocialLinks social-links-list" data-v-f953d92f data-v-e71e869c><!--[--><a class="VPSocialLink no-icon" href="https://github.com/Jvavscratch/jvavscratch" aria-label="github" target="_blank" rel="noopener" data-v-e71e869c data-v-60a9a2d3><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-9fd4d1dd data-v-6bee1efd><span class="container" data-v-6bee1efd><span class="top" data-v-6bee1efd></span><span class="middle" data-v-6bee1efd></span><span class="bottom" data-v-6bee1efd></span></span></button></div></div></div></div><div class="divider" data-v-9fd4d1dd><div class="divider-line" data-v-9fd4d1dd></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-d8b57b2d data-v-2488c25a><div class="container" data-v-2488c25a><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-2488c25a><span class="vpi-align-left menu-icon" data-v-2488c25a></span><span class="menu-text" data-v-2488c25a>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-2488c25a data-v-6b867909><button data-v-6b867909>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-d8b57b2d data-v-42c4c606><div class="curtain" data-v-42c4c606></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-42c4c606><span class="visually-hidden" id="sidebar-aria-label" data-v-42c4c606> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-51288d80><section class="VPSidebarItem level-0 has-active" data-v-51288d80 data-v-0009425e><!----><div class="items" data-v-0009425e><!--[--><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/jvavscratch/modules/cli.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>CLI模块</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/jvavscratch/modules/core.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Core模块</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/jvavscratch/modules/generator.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Generator模块</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/jvavscratch/modules/decompiler.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Decompiler模块</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/jvavscratch/modules/types.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Types模块</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/jvavscratch/modules/utils.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Utils模块</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-d8b57b2d data-v-9a6c75ad><div class="VPDoc has-sidebar has-aside" data-v-9a6c75ad data-v-e6f2a212><!--[--><!--]--><div class="container" data-v-e6f2a212><div class="aside" data-v-e6f2a212><div class="aside-curtain" data-v-e6f2a212></div><div class="aside-container" data-v-e6f2a212><div class="aside-content" data-v-e6f2a212><div class="VPDocAside" data-v-e6f2a212 data-v-cb998dce><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-cb998dce data-v-f610f197><div class="content" data-v-f610f197><div class="outline-marker" data-v-f610f197></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-f610f197>On this page</div><ul class="VPDocOutlineItem root" data-v-f610f197 data-v-53c99d69><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-cb998dce></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-e6f2a212><div class="content-container" data-v-e6f2a212><!--[--><!--]--><main class="main" data-v-e6f2a212><div style="position:relative;" class="vp-doc _jvavscratch_modules_core" data-v-e6f2a212><div><h1 id="core-模块" tabindex="-1">Core 模块 <a class="header-anchor" href="#core-模块" aria-label="Permalink to &quot;Core 模块&quot;">​</a></h1><p>Core模块是jvavscratch的核心转换引擎，负责语法分析、代码转换和中间表示处理。它是连接JavaScript代码和Scratch项目的桥梁，处理了从高级语言到底层Scratch块的复杂转换过程。</p><h2 id="模块架构" tabindex="-1">模块架构 <a class="header-anchor" href="#模块架构" aria-label="Permalink to &quot;模块架构&quot;">​</a></h2><p>Core模块由以下几个主要组件组成：</p><ol><li><strong>解析器（Parser）</strong>：将JavaScript代码解析为抽象语法树（AST）</li><li><strong>转换器（Transformer）</strong>：将AST转换为中间表示（IR）</li><li><strong>代码生成器（Code Generator）</strong>：将IR转换为Scratch块表示</li><li><strong>类型检查器（Type Checker）</strong>：验证代码的类型正确性</li><li><strong>语义分析器（Semantic Analyzer）</strong>：执行语义检查和优化</li></ol><h2 id="api概述" tabindex="-1">API概述 <a class="header-anchor" href="#api概述" aria-label="Permalink to &quot;API概述&quot;">​</a></h2><h3 id="parser-api" tabindex="-1">Parser API <a class="header-anchor" href="#parser-api" aria-label="Permalink to &quot;Parser API&quot;">​</a></h3><h4 id="parse-code" tabindex="-1"><code>parse(code)</code> <a class="header-anchor" href="#parse-code" aria-label="Permalink to &quot;`parse(code)`&quot;">​</a></h4><p>将JavaScript代码解析为抽象语法树。</p><p><strong>参数：</strong></p><ul><li><code>code</code>: 要解析的JavaScript代码字符串</li></ul><p><strong>返回值：</strong></p><ul><li>解析后的抽象语法树对象</li></ul><p><strong>示例：</strong></p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">parse</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;jvavscratch/core/parser&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> ast</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> parse</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;let x = 10;&#39;</span><span style="color:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="parsefile-filepath" tabindex="-1"><code>parseFile(filePath)</code> <a class="header-anchor" href="#parsefile-filepath" aria-label="Permalink to &quot;`parseFile(filePath)`&quot;">​</a></h4><p>从文件中读取代码并解析为抽象语法树。</p><p><strong>参数：</strong></p><ul><li><code>filePath</code>: 文件路径</li></ul><p><strong>返回值：</strong></p><ul><li>解析后的抽象语法树对象</li></ul><p><strong>示例：</strong></p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">parseFile</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;jvavscratch/core/parser&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> ast</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> parseFile</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;./src/main.js&#39;</span><span style="color:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="transformer-api" tabindex="-1">Transformer API <a class="header-anchor" href="#transformer-api" aria-label="Permalink to &quot;Transformer API&quot;">​</a></h3><h4 id="transform-ast-options" tabindex="-1"><code>transform(ast, options)</code> <a class="header-anchor" href="#transform-ast-options" aria-label="Permalink to &quot;`transform(ast, options)`&quot;">​</a></h4><p>将抽象语法树转换为中间表示。</p><p><strong>参数：</strong></p><ul><li><code>ast</code>: 抽象语法树</li><li><code>options</code>: 转换选项 <ul><li><code>strictMode</code>: 是否启用严格模式（默认：false）</li><li><code>optimize</code>: 是否优化（默认：true）</li></ul></li></ul><p><strong>返回值：</strong></p><ul><li>中间表示对象</li></ul><p><strong>示例：</strong></p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">transform</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;jvavscratch/core/transformer&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> ir</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> transform</span><span style="color:#E1E4E8;">(ast, { strictMode: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;"> });</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="code-generator-api" tabindex="-1">Code Generator API <a class="header-anchor" href="#code-generator-api" aria-label="Permalink to &quot;Code Generator API&quot;">​</a></h3><h4 id="generatescratchblocks-ir-options" tabindex="-1"><code>generateScratchBlocks(ir, options)</code> <a class="header-anchor" href="#generatescratchblocks-ir-options" aria-label="Permalink to &quot;`generateScratchBlocks(ir, options)`&quot;">​</a></h4><p>将中间表示转换为Scratch块表示。</p><p><strong>参数：</strong></p><ul><li><code>ir</code>: 中间表示对象</li><li><code>options</code>: 生成选项 <ul><li><code>optimizeBlocks</code>: 是否优化块结构（默认：true）</li><li><code>comments</code>: 是否保留注释（默认：true）</li></ul></li></ul><p><strong>返回值：</strong></p><ul><li>Scratch块表示对象</li></ul><p><strong>示例：</strong></p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">generateScratchBlocks</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;jvavscratch/core/generator&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> blocks</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> generateScratchBlocks</span><span style="color:#E1E4E8;">(ir);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="type-checker-api" tabindex="-1">Type Checker API <a class="header-anchor" href="#type-checker-api" aria-label="Permalink to &quot;Type Checker API&quot;">​</a></h3><h4 id="checktypes-ast" tabindex="-1"><code>checkTypes(ast)</code> <a class="header-anchor" href="#checktypes-ast" aria-label="Permalink to &quot;`checkTypes(ast)`&quot;">​</a></h4><p>验证代码的类型正确性。</p><p><strong>参数：</strong></p><ul><li><code>ast</code>: 抽象语法树</li></ul><p><strong>返回值：</strong></p><ul><li>类型检查结果对象，包含错误列表和警告列表</li></ul><p><strong>示例：</strong></p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">checkTypes</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;jvavscratch/core/type-checker&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> result</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> checkTypes</span><span style="color:#E1E4E8;">(ast);</span></span>
<span class="line"><span style="color:#E1E4E8;">console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(result.errors);</span></span>
<span class="line"><span style="color:#E1E4E8;">console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(result.warnings);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="semantic-analyzer-api" tabindex="-1">Semantic Analyzer API <a class="header-anchor" href="#semantic-analyzer-api" aria-label="Permalink to &quot;Semantic Analyzer API&quot;">​</a></h3><h4 id="analyze-ast-options" tabindex="-1"><code>analyze(ast, options)</code> <a class="header-anchor" href="#analyze-ast-options" aria-label="Permalink to &quot;`analyze(ast, options)`&quot;">​</a></h4><p>执行语义分析和优化。</p><p><strong>参数：</strong></p><ul><li><code>ast</code>: 抽象语法树</li><li><code>options</code>: 分析选项 <ul><li><code>optimize</code>: 是否执行优化（默认：true）</li><li><code>deadCodeElimination</code>: 是否消除死代码（默认：true）</li></ul></li></ul><p><strong>返回值：</strong></p><ul><li>分析后的抽象语法树</li></ul><p><strong>示例：</strong></p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">analyze</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;jvavscratch/core/semantic-analyzer&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> optimizedAst</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> analyze</span><span style="color:#E1E4E8;">(ast);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="中间表示-ir" tabindex="-1">中间表示（IR） <a class="header-anchor" href="#中间表示-ir" aria-label="Permalink to &quot;中间表示（IR）&quot;">​</a></h2><p>中间表示是Core模块中最重要的概念之一，它是一种介于JavaScript AST和Scratch块之间的表示形式，专为Scratch转换设计。中间表示包含以下主要部分：</p><ol><li><strong>变量表</strong>：记录所有变量的定义和使用</li><li><strong>函数表</strong>：记录所有函数的定义和调用</li><li><strong>控制流图</strong>：表示代码的执行流程</li><li><strong>块映射</strong>：将AST节点映射到Scratch块</li></ol><h3 id="中间表示示例" tabindex="-1">中间表示示例 <a class="header-anchor" href="#中间表示示例" aria-label="Permalink to &quot;中间表示示例&quot;">​</a></h3><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> ir</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  variables: [</span></span>
<span class="line"><span style="color:#E1E4E8;">    { name: </span><span style="color:#9ECBFF;">&#39;x&#39;</span><span style="color:#E1E4E8;">, type: </span><span style="color:#9ECBFF;">&#39;number&#39;</span><span style="color:#E1E4E8;">, isGlobal: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;"> },</span></span>
<span class="line"><span style="color:#E1E4E8;">    { name: </span><span style="color:#9ECBFF;">&#39;y&#39;</span><span style="color:#E1E4E8;">, type: </span><span style="color:#9ECBFF;">&#39;string&#39;</span><span style="color:#E1E4E8;">, isGlobal: </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> }</span></span>
<span class="line"><span style="color:#E1E4E8;">  ],</span></span>
<span class="line"><span style="color:#E1E4E8;">  functions: [</span></span>
<span class="line"><span style="color:#E1E4E8;">    { name: </span><span style="color:#9ECBFF;">&#39;myFunction&#39;</span><span style="color:#E1E4E8;">, params: [</span><span style="color:#9ECBFF;">&#39;a&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;b&#39;</span><span style="color:#E1E4E8;">], body: [</span><span style="color:#F97583;">...</span><span style="color:#E1E4E8;">] }</span></span>
<span class="line"><span style="color:#E1E4E8;">  ],</span></span>
<span class="line"><span style="color:#E1E4E8;">  blocks: [</span></span>
<span class="line"><span style="color:#E1E4E8;">    { type: </span><span style="color:#9ECBFF;">&#39;setVariable&#39;</span><span style="color:#E1E4E8;">, variable: </span><span style="color:#9ECBFF;">&#39;x&#39;</span><span style="color:#E1E4E8;">, value: </span><span style="color:#79B8FF;">10</span><span style="color:#E1E4E8;"> },</span></span>
<span class="line"><span style="color:#E1E4E8;">    { type: </span><span style="color:#9ECBFF;">&#39;if&#39;</span><span style="color:#E1E4E8;">, condition: { type: </span><span style="color:#9ECBFF;">&#39;equals&#39;</span><span style="color:#E1E4E8;">, left: { type: </span><span style="color:#9ECBFF;">&#39;variable&#39;</span><span style="color:#E1E4E8;">, name: </span><span style="color:#9ECBFF;">&#39;x&#39;</span><span style="color:#E1E4E8;"> }, right: </span><span style="color:#79B8FF;">10</span><span style="color:#E1E4E8;"> }, then: [</span><span style="color:#F97583;">...</span><span style="color:#E1E4E8;">], else: [</span><span style="color:#F97583;">...</span><span style="color:#E1E4E8;">] }</span></span>
<span class="line"><span style="color:#E1E4E8;">  ]</span></span>
<span class="line"><span style="color:#E1E4E8;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="类型系统" tabindex="-1">类型系统 <a class="header-anchor" href="#类型系统" aria-label="Permalink to &quot;类型系统&quot;">​</a></h2><p>Core模块实现了一个简单的类型系统，支持以下基本类型：</p><ul><li><code>number</code>: 数字</li><li><code>string</code>: 字符串</li><li><code>boolean</code>: 布尔值</li><li><code>array</code>: 数组（对应Scratch中的列表）</li><li><code>undefined</code>: 未定义</li><li><code>object</code>: 对象（有限支持）</li></ul><p>类型系统用于确保代码在转换为Scratch时的正确性，并提供类型检查错误提示。</p><h2 id="错误处理" tabindex="-1">错误处理 <a class="header-anchor" href="#错误处理" aria-label="Permalink to &quot;错误处理&quot;">​</a></h2><p>Core模块提供了详细的错误报告机制，包括：</p><ol><li><strong>语法错误</strong>：代码不符合JavaScript语法</li><li><strong>语义错误</strong>：代码在语义上有问题</li><li><strong>类型错误</strong>：类型不匹配或类型不支持</li><li><strong>转换错误</strong>：无法转换为Scratch的代码结构</li></ol><p>错误报告包含错误类型、位置和详细描述，帮助用户快速定位和修复问题。</p><h2 id="性能优化" tabindex="-1">性能优化 <a class="header-anchor" href="#性能优化" aria-label="Permalink to &quot;性能优化&quot;">​</a></h2><p>Core模块实现了多种优化策略，以提高生成的Scratch项目的性能：</p><ol><li><strong>常量折叠</strong>：预计算常量表达式</li><li><strong>死代码消除</strong>：移除永远不会执行的代码</li><li><strong>公共子表达式消除</strong>：避免重复计算</li><li><strong>块结构优化</strong>：生成更高效的Scratch块结构</li></ol><h2 id="扩展性" tabindex="-1">扩展性 <a class="header-anchor" href="#扩展性" aria-label="Permalink to &quot;扩展性&quot;">​</a></h2><p>Core模块设计为可扩展的，允许通过插件机制添加新功能：</p><ol><li><strong>解析器插件</strong>：扩展语法支持</li><li><strong>转换器插件</strong>：自定义转换规则</li><li><strong>生成器插件</strong>：自定义块生成</li></ol><p>详细的插件开发指南请参考<a href="/jvavscratch/plugins.html">插件开发</a>文档。</p></div></div></main><footer class="VPDocFooter" data-v-e6f2a212 data-v-1bcd8184><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-1bcd8184><span class="visually-hidden" id="doc-footer-aria-label" data-v-1bcd8184>Pager</span><div class="pager" data-v-1bcd8184><a class="VPLink link pager-link prev" href="/jvavscratch/modules/cli.html" data-v-1bcd8184><!--[--><span class="desc" data-v-1bcd8184>Previous page</span><span class="title" data-v-1bcd8184>CLI模块</span><!--]--></a></div><div class="pager" data-v-1bcd8184><a class="VPLink link pager-link next" href="/jvavscratch/modules/generator.html" data-v-1bcd8184><!--[--><span class="desc" data-v-1bcd8184>Next page</span><span class="title" data-v-1bcd8184>Generator模块</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-d8b57b2d data-v-566314d4><div class="container" data-v-566314d4><p class="message" data-v-566314d4>基于MPL-2.0开源协议</p><p class="copyright" data-v-566314d4>© 2024 Jvavscratch团队</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"api_builtins.md\":\"BjBSuIBy\",\"api_examples.md\":\"CAV_40pB\",\"api_index.md\":\"DyLRJCB_\",\"api_looks.md\":\"BTzc66yG\",\"api_motion.md\":\"CZm_6aSx\",\"api_sound.md\":\"BRVka4WM\",\"faq_index.md\":\"CTGwc0fD\",\"grammar_classes.md\":\"DBqzUg61\",\"grammar_control-flow.md\":\"DMfruHi4\",\"grammar_events.md\":\"CkBldhdw\",\"grammar_functions.md\":\"BzMinzxP\",\"grammar_index.md\":\"CaruTe-0\",\"grammar_variables.md\":\"Dk4jmqqi\",\"guide_basic-usage.md\":\"WngcA2ij\",\"guide_getting-started.md\":\"Clg1lP3k\",\"guide_installation.md\":\"C3RA9A8d\",\"modules_cli.md\":\"DjzUYi67\",\"modules_core.md\":\"B4quvw7D\",\"modules_decompiler.md\":\"BTySe9yF\",\"modules_generator.md\":\"BhROKQvT\",\"modules_index.md\":\"x2TuSL8K\",\"modules_registry.md\":\"CNEvPtzZ\",\"modules_runtime.md\":\"CuRpGYKv\",\"modules_types.md\":\"DMFI9wSA\",\"modules_utils.md\":\"BIwuaeN9\",\"readme.md\":\"BaERuc5b\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Jvavscratch\",\"description\":\"JavaScript到Scratch的转换工具 - 让编程学习更简单\",\"base\":\"/jvavscratch/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"logo\":\"/logo.svg\",\"siteTitle\":\"Jvavscratch\",\"nav\":[{\"text\":\"首页\",\"link\":\"/\"},{\"text\":\"指南\",\"link\":\"/guide/\"},{\"text\":\"语法\",\"link\":\"/grammar/\"},{\"text\":\"API\",\"link\":\"/api/\"},{\"text\":\"模块\",\"link\":\"/modules/\"},{\"text\":\"常见问题\",\"link\":\"/faq/\"},{\"text\":\"GitHub\",\"link\":\"https://github.com/Jvavscratch/jvavscratch\"}],\"sidebar\":{\"/guide/\":[{\"text\":\"快速开始\",\"link\":\"/guide/getting-started\"},{\"text\":\"安装\",\"link\":\"/guide/installation\"},{\"text\":\"基本使用\",\"link\":\"/guide/basic-usage\"}],\"/grammar/\":[{\"text\":\"语法概览\",\"link\":\"/grammar/\"},{\"text\":\"变量和赋值\",\"link\":\"/grammar/variables\"},{\"text\":\"控制流\",\"link\":\"/grammar/control-flow\"},{\"text\":\"函数\",\"link\":\"/grammar/functions\"},{\"text\":\"类和继承\",\"link\":\"/grammar/classes\"},{\"text\":\"事件块\",\"link\":\"/grammar/events\"}],\"/api/\":[{\"text\":\"内置函数\",\"link\":\"/api/builtins\"},{\"text\":\"运动API\",\"link\":\"/api/motion\"},{\"text\":\"外观API\",\"link\":\"/api/looks\"},{\"text\":\"声音API\",\"link\":\"/api/sound\"}],\"/modules/\":[{\"text\":\"CLI模块\",\"link\":\"/modules/cli\"},{\"text\":\"Core模块\",\"link\":\"/modules/core\"},{\"text\":\"Generator模块\",\"link\":\"/modules/generator\"},{\"text\":\"Decompiler模块\",\"link\":\"/modules/decompiler\"},{\"text\":\"Types模块\",\"link\":\"/modules/types\"},{\"text\":\"Utils模块\",\"link\":\"/modules/utils\"}],\"/\":[{\"text\":\"首页\",\"link\":\"/\"},{\"text\":\"快速开始\",\"link\":\"/guide/getting-started\"},{\"text\":\"语法概览\",\"link\":\"/grammar/\"},{\"text\":\"常见问题\",\"link\":\"/faq/\"}]},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/Jvavscratch/jvavscratch\"}],\"search\":{\"provider\":\"local\"},\"footer\":{\"message\":\"基于MPL-2.0开源协议\",\"copyright\":\"© 2024 Jvavscratch团队\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>