import{_ as a,c as n,o as l,ag as e}from"./chunks/framework.DQvKz0xt.js";const u=JSON.parse('{"title":"Decompiler 模块","description":"","frontmatter":{},"headers":[],"relativePath":"modules/decompiler.md","filePath":"modules/decompiler.md"}'),p={name:"modules/decompiler.md"};function o(r,s,t,c,i,d){return l(),n("div",null,[...s[0]||(s[0]=[e(`<h1 id="decompiler-模块" tabindex="-1">Decompiler 模块 <a class="header-anchor" href="#decompiler-模块" aria-label="Permalink to &quot;Decompiler 模块&quot;">​</a></h1><p>Decompiler模块是jvavscratch的反编译工具，能够将Scratch项目文件(.sb3)反编译为jvavscratch JavaScript代码。这个模块使得用户可以将现有的Scratch项目转换为JavaScript代码进行编辑，然后再重新编译回Scratch项目。</p><h2 id="模块功能" tabindex="-1">模块功能 <a class="header-anchor" href="#模块功能" aria-label="Permalink to &quot;模块功能&quot;">​</a></h2><p>Decompiler模块主要提供以下功能：</p><ol><li>解析Scratch项目文件(.sb3)</li><li>提取精灵、背景、变量、列表和广播消息</li><li>将Scratch块转换为JavaScript代码</li><li>生成符合jvavscratch语法的代码文件</li><li>支持自定义反编译选项</li></ol><h2 id="api概述" tabindex="-1">API概述 <a class="header-anchor" href="#api概述" aria-label="Permalink to &quot;API概述&quot;">​</a></h2><h3 id="核心api" tabindex="-1">核心API <a class="header-anchor" href="#核心api" aria-label="Permalink to &quot;核心API&quot;">​</a></h3><h4 id="decompileproject-filepath-options" tabindex="-1"><code>decompileProject(filePath, options)</code> <a class="header-anchor" href="#decompileproject-filepath-options" aria-label="Permalink to &quot;\`decompileProject(filePath, options)\`&quot;">​</a></h4><p>反编译Scratch项目文件。</p><p><strong>参数：</strong></p><ul><li><code>filePath</code>: Scratch项目文件(.sb3)的路径</li><li><code>options</code>: 反编译选项 <ul><li><code>output</code>: 输出目录路径（默认：当前目录下的<code>decompiled</code>目录）</li><li><code>format</code>: 输出格式（&quot;js&quot; 或 &quot;ts&quot;，默认：&quot;js&quot;）</li><li><code>includeComments</code>: 是否包含注释（默认：true）</li><li><code>optimizeNames</code>: 是否优化变量和函数名称（默认：true）</li><li><code>preserveStructure</code>: 是否保留原始结构（默认：true）</li></ul></li></ul><p><strong>返回值：</strong></p><ul><li>Promise，解析为反编译后的项目信息对象</li></ul><p><strong>示例：</strong></p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">decompileProject</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;jvavscratch/decompiler&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> result</span><span style="color:#F97583;"> =</span><span style="color:#F97583;"> await</span><span style="color:#B392F0;"> decompileProject</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;./project.sb3&#39;</span><span style="color:#E1E4E8;">, {</span></span>
<span class="line"><span style="color:#E1E4E8;">  output: </span><span style="color:#9ECBFF;">&#39;./my-project&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  format: </span><span style="color:#9ECBFF;">&#39;js&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  includeComments: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="parsesb3file-filepath" tabindex="-1"><code>parseSb3File(filePath)</code> <a class="header-anchor" href="#parsesb3file-filepath" aria-label="Permalink to &quot;\`parseSb3File(filePath)\`&quot;">​</a></h4><p>解析Scratch项目文件，但不生成JavaScript代码。</p><p><strong>参数：</strong></p><ul><li><code>filePath</code>: Scratch项目文件(.sb3)的路径</li></ul><p><strong>返回值：</strong></p><ul><li>Promise，解析为项目数据对象</li></ul><p><strong>示例：</strong></p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">parseSb3File</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;jvavscratch/decompiler&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> projectData</span><span style="color:#F97583;"> =</span><span style="color:#F97583;"> await</span><span style="color:#B392F0;"> parseSb3File</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;./project.sb3&#39;</span><span style="color:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="blockstocode-blocks-options" tabindex="-1"><code>blocksToCode(blocks, options)</code> <a class="header-anchor" href="#blockstocode-blocks-options" aria-label="Permalink to &quot;\`blocksToCode(blocks, options)\`&quot;">​</a></h4><p>将Scratch块转换为JavaScript代码。</p><p><strong>参数：</strong></p><ul><li><code>blocks</code>: Scratch块对象</li><li><code>options</code>: 转换选项 <ul><li><code>includeComments</code>: 是否包含注释（默认：true）</li><li><code>optimizeNames</code>: 是否优化变量名称（默认：true）</li></ul></li></ul><p><strong>返回值：</strong></p><ul><li>JavaScript代码字符串</li></ul><p><strong>示例：</strong></p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">blocksToCode</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;jvavscratch/decompiler&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> code</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> blocksToCode</span><span style="color:#E1E4E8;">(spriteBlocks, {</span></span>
<span class="line"><span style="color:#E1E4E8;">  includeComments: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="工具api" tabindex="-1">工具API <a class="header-anchor" href="#工具api" aria-label="Permalink to &quot;工具API&quot;">​</a></h3><h4 id="extractassets-projectdata-outputdir" tabindex="-1"><code>extractAssets(projectData, outputDir)</code> <a class="header-anchor" href="#extractassets-projectdata-outputdir" aria-label="Permalink to &quot;\`extractAssets(projectData, outputDir)\`&quot;">​</a></h4><p>提取Scratch项目中的资源（图像、音频等）。</p><p><strong>参数：</strong></p><ul><li><code>projectData</code>: 项目数据对象，从<code>parseSb3File</code>获取</li><li><code>outputDir</code>: 资源输出目录</li></ul><p><strong>返回值：</strong></p><ul><li>Promise，解析为提取的资源列表</li></ul><p><strong>示例：</strong></p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">parseSb3File</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">extractAssets</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;jvavscratch/decompiler&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> projectData</span><span style="color:#F97583;"> =</span><span style="color:#F97583;"> await</span><span style="color:#B392F0;"> parseSb3File</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;./project.sb3&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> assets</span><span style="color:#F97583;"> =</span><span style="color:#F97583;"> await</span><span style="color:#B392F0;"> extractAssets</span><span style="color:#E1E4E8;">(projectData, </span><span style="color:#9ECBFF;">&#39;./assets&#39;</span><span style="color:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="generateprojectstructure-projectdata-options" tabindex="-1"><code>generateProjectStructure(projectData, options)</code> <a class="header-anchor" href="#generateprojectstructure-projectdata-options" aria-label="Permalink to &quot;\`generateProjectStructure(projectData, options)\`&quot;">​</a></h4><p>生成项目结构对象。</p><p><strong>参数：</strong></p><ul><li><code>projectData</code>: 项目数据对象</li><li><code>options</code>: 生成选项 <ul><li><code>format</code>: 输出格式（&quot;js&quot; 或 &quot;ts&quot;）</li></ul></li></ul><p><strong>返回值：</strong></p><ul><li>项目结构对象，包含文件和目录信息</li></ul><p><strong>示例：</strong></p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">parseSb3File</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">generateProjectStructure</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;jvavscratch/decompiler&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> projectData</span><span style="color:#F97583;"> =</span><span style="color:#F97583;"> await</span><span style="color:#B392F0;"> parseSb3File</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;./project.sb3&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> structure</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> generateProjectStructure</span><span style="color:#E1E4E8;">(projectData, { format: </span><span style="color:#9ECBFF;">&#39;js&#39;</span><span style="color:#E1E4E8;"> });</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="反编译流程" tabindex="-1">反编译流程 <a class="header-anchor" href="#反编译流程" aria-label="Permalink to &quot;反编译流程&quot;">​</a></h2><p>反编译过程包含以下主要步骤：</p><ol><li><strong>解压项目文件</strong>：.sb3文件实际上是一个ZIP压缩文件，需要先解压</li><li><strong>解析项目配置</strong>：读取<code>project.json</code>文件，获取项目结构</li><li><strong>提取精灵和背景</strong>：获取所有精灵和背景信息</li><li><strong>分析变量和列表</strong>：提取所有变量和列表定义</li><li><strong>转换代码块</strong>：将每个精灵和背景的代码块转换为JavaScript代码</li><li><strong>生成文件结构</strong>：创建适当的文件和目录结构</li><li><strong>写入输出文件</strong>：将生成的代码写入输出目录</li></ol><h2 id="反编译示例" tabindex="-1">反编译示例 <a class="header-anchor" href="#反编译示例" aria-label="Permalink to &quot;反编译示例&quot;">​</a></h2><h3 id="命令行反编译" tabindex="-1">命令行反编译 <a class="header-anchor" href="#命令行反编译" aria-label="Permalink to &quot;命令行反编译&quot;">​</a></h3><p>最简单的方法是使用CLI工具进行反编译：</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">jvavscratch</span><span style="color:#9ECBFF;"> decompile</span><span style="color:#9ECBFF;"> ./project.sb3</span><span style="color:#79B8FF;"> --output</span><span style="color:#9ECBFF;"> ./my-project</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="编程方式反编译" tabindex="-1">编程方式反编译 <a class="header-anchor" href="#编程方式反编译" aria-label="Permalink to &quot;编程方式反编译&quot;">​</a></h3><p>也可以通过API以编程方式进行反编译：</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">decompileProject</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;jvavscratch/decompiler&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">async</span><span style="color:#F97583;"> function</span><span style="color:#B392F0;"> decompileMyProject</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">  try</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">    const</span><span style="color:#79B8FF;"> result</span><span style="color:#F97583;"> =</span><span style="color:#F97583;"> await</span><span style="color:#B392F0;"> decompileProject</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;./project.sb3&#39;</span><span style="color:#E1E4E8;">, {</span></span>
<span class="line"><span style="color:#E1E4E8;">      output: </span><span style="color:#9ECBFF;">&#39;./my-project&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">      format: </span><span style="color:#9ECBFF;">&#39;js&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">      includeComments: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">      optimizeNames: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">    });</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;反编译成功！&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">\`生成了 \${</span><span style="color:#E1E4E8;">result</span><span style="color:#9ECBFF;">.</span><span style="color:#E1E4E8;">files</span><span style="color:#9ECBFF;">.</span><span style="color:#79B8FF;">length</span><span style="color:#9ECBFF;">} 个文件\`</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">\`输出目录: \${</span><span style="color:#E1E4E8;">result</span><span style="color:#9ECBFF;">.</span><span style="color:#E1E4E8;">outputDir</span><span style="color:#9ECBFF;">}\`</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">  } </span><span style="color:#F97583;">catch</span><span style="color:#E1E4E8;"> (error) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    console.</span><span style="color:#B392F0;">error</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;反编译失败:&#39;</span><span style="color:#E1E4E8;">, error);</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">decompileMyProject</span><span style="color:#E1E4E8;">();</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h2 id="生成的文件结构" tabindex="-1">生成的文件结构 <a class="header-anchor" href="#生成的文件结构" aria-label="Permalink to &quot;生成的文件结构&quot;">​</a></h2><p>反编译后，会生成以下文件结构：</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>my-project/</span></span>
<span class="line"><span>├── jvavscratch.config.js  # 项目配置文件</span></span>
<span class="line"><span>├── src/</span></span>
<span class="line"><span>│   ├── main.js           # 主入口文件</span></span>
<span class="line"><span>│   ├── sprites/          # 精灵代码目录</span></span>
<span class="line"><span>│   │   ├── Sprite1.js    # 第一个精灵的代码</span></span>
<span class="line"><span>│   │   ├── Sprite2.js    # 第二个精灵的代码</span></span>
<span class="line"><span>│   │   └── ...</span></span>
<span class="line"><span>│   └── stage.js          # 舞台（背景）代码</span></span>
<span class="line"><span>└── assets/               # 资源目录（如果提取了资源）</span></span>
<span class="line"><span>    ├── costumes/         # 造型文件</span></span>
<span class="line"><span>    └── sounds/           # 音效文件</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="反编译限制" tabindex="-1">反编译限制 <a class="header-anchor" href="#反编译限制" aria-label="Permalink to &quot;反编译限制&quot;">​</a></h2><p>尽管Decompiler模块功能强大，但由于Scratch和JavaScript之间的差异，仍存在一些限制：</p><ol><li><strong>代码结构转换</strong>：Scratch的块编程结构与JavaScript的文本编程结构存在根本差异，某些复杂的块结构可能无法完美转换</li><li><strong>变量类型</strong>：Scratch变量在反编译时会根据使用情况推断类型，但可能不够准确</li><li><strong>自定义块</strong>：自定义块的反编译可能不够理想，特别是复杂的自定义块</li><li><strong>特殊效果</strong>：某些Scratch特有的效果可能需要特殊处理</li><li><strong>注释</strong>：Scratch中的注释会尽可能保留，但可能不够完善</li></ol><h2 id="最佳实践" tabindex="-1">最佳实践 <a class="header-anchor" href="#最佳实践" aria-label="Permalink to &quot;最佳实践&quot;">​</a></h2><ol><li><strong>验证反编译结果</strong>：反编译后，应检查生成的代码是否符合预期</li><li><strong>适度编辑</strong>：对反编译的代码进行编辑时，应保持在jvavscratch支持的语法范围内</li><li><strong>重新编译测试</strong>：编辑后，应重新编译为Scratch项目并测试功能</li><li><strong>保留原始项目</strong>：在反编译和编辑过程中，始终保留原始的Scratch项目作为备份</li></ol><h2 id="疑难解答" tabindex="-1">疑难解答 <a class="header-anchor" href="#疑难解答" aria-label="Permalink to &quot;疑难解答&quot;">​</a></h2><h3 id="反编译失败" tabindex="-1">反编译失败 <a class="header-anchor" href="#反编译失败" aria-label="Permalink to &quot;反编译失败&quot;">​</a></h3><p>如果反编译失败，可能的原因包括：</p><ol><li>Scratch项目文件损坏</li><li>项目使用了不支持的Scratch扩展或功能</li><li>文件路径问题</li></ol><h3 id="生成的代码有问题" tabindex="-1">生成的代码有问题 <a class="header-anchor" href="#生成的代码有问题" aria-label="Permalink to &quot;生成的代码有问题&quot;">​</a></h3><p>如果生成的代码有问题，可以尝试：</p><ol><li>调整反编译选项，特别是<code>optimizeNames</code>和<code>preserveStructure</code>选项</li><li>手动修复生成的代码中的问题</li><li>对于复杂项目，考虑部分手动转换</li></ol>`,73)])])}const b=a(p,[["render",o]]);export{u as __pageData,b as default};
